# ZKS Protocol: Zero-Knowledge Swarm
**Version:** 1.0.0
**Date:** December 15, 2025
**Author:** Md. Wasif Faisal

## Abstract
The ZKS Protocol is a decentralized, application-layer communication protocol designed for secure, anonymous, and limit-free file sharing. Unlike traditional P2P protocols (BitTorrent, IPFS) or centralized services (WeTransfer), ZKS utilizes a unique **Vernam Cipher (One-Time Pad) over WebRTC Mesh** architecture. This ensures that no single entity—not even the relay servers—possesses the complete information required to decrypt the data, achieving true Zero-Knowledge privacy.

## 1. Formal Definition

**ZKS (Zero-Knowledge Swarm)** is an **Application-Layer Secure Overlay Protocol** (OSI Layer 7) that implements **Information-Theoretic Security** for data streams.

It operates as a **Tunneling Protocol** on top of standard transport layers (WebRTC/SCTP and WebSocket/TCP). Unlike standard encryption protocols (TLS/SSL) which rely on computational complexity, ZKS enforces a **Split-Key Architecture** where the encryption stream (`Key B`) and the data stream (`Ciphertext`) are mathematically forced to travel through disjoint network paths, reassembling only at the endpoint.

### 1.1 OSI Model Classification
ZKS operates primarily at **Layer 7 (Application Layer)** of the OSI Model, while providing services traditionally associated with **Layer 6 (Presentation Layer)**.

*   **Layer 7 (Application):** The ZKS Client (Browser/App) manages the logic of Key Streaming, Peer Coordination, and Data Packetization.
*   **Layer 6 (Presentation):** The Vernam Cipher (XOR) handles the encryption and decryption of data formats (Text, Binary, Media) into a uniform secure stream.
*   **Underlying Transport:** ZKS is transport-agnostic but currently runs over **WebRTC (UDP/TCP)** and **WebSockets (TCP)**, effectively tunneling its own secure protocol over existing Layer 7 infrastructure.

## 2. Core Concepts

### 2.1. The Vernam Split (KeyA + KeyB)
The defining feature of ZKS is its encryption scheme. Instead of relying solely on computational hardness (like AES-256), ZKS approximates the **One-Time Pad** (Vernam Cipher), the only mathematically unbreakable encryption.

*   **KeyA (Local):** Generated by the sender's browser. Never leaves the client except via direct, encrypted P2P channels.
*   **KeyB (Remote):** Streamed from a high-throughput worker.
*   **The XOR Operation:** `Ciphertext = Plaintext ⊕ KeyA ⊕ KeyB`

### 2.3. Randomness Source (Entropy)
ZKS leverages Cloudflare's **LavaRand** infrastructure for `KeyB` generation.
*   **Source:** Physical entropy (lava lamps, chaotic pendulums) mixed with Linux `urandom`.
*   **Quality:** Cryptographically Secure Pseudorandom Number Generator (CSPRNG).
*   **Security Level:** Computational Security (Standard for Banking/Military).
*   **vs. Quantum:** While not "True Quantum" (physics-based), the entropy pool is sufficient to prevent any statistical attack.

### 2.4. The Swarm (Mesh Networking)
ZKS builds an ad-hoc mesh network for every transfer session.
*   **Sender:** The initial seed.
*   **Relay:** A dumb pipe for signaling and encrypted traffic fallback.
*   **Peers:** Receivers who immediately become seeders for chunks they possess.

## 3. Protocol Specification

### 3.1. Session Initialization
1.  **Hashing:** Sender calculates SHA-256 hash of the file.
2.  **Session ID:** `SessionID = Substring(Hash, 0, 16)`
3.  **Key Generation:** Sender generates `KeyA` (random bytes matching file size).
4.  **Key Fetching:** Sender requests `KeyB` from the Key Worker.

### 2.2. Signaling (WebSocket)
All peers connect to a central relay (Cloudflare Worker) for discovery.
*   **Protocol:** JSON over WebSocket (`wss://`)
*   **Message Types:**
    *   `join`: Peer enters the room.
    *   `offer` / `answer` / `ice`: WebRTC signaling (SDP).
    *   `file_request`: Receiver asks for metadata.
    *   `file_start`: Sender broadcasts metadata (Name, Size, TotalChunks).

### 2.3. The Handshake (Key Exchange)
Before data transfer, keys must be distributed securely.
1.  **KeyA Distribution:** Sent via Relay (Encrypted? No, but useless without KeyB) OR via P2P DataChannel (Preferred).
2.  **KeyB Distribution:**
    *   *Scenario 1 (High Security):* Sent via P2P DataChannel only.
    *   *Scenario 2 (Fallback):* Sent via Relay.

### 2.4. Data Transfer (Hybrid Transport)
ZKS uses a "Race" strategy to maximize speed and reliability.
*   **Transport A (Relay):** WebSocket binary frames. Reliable, works behind firewalls, but higher latency.
*   **Transport B (P2P):** WebRTC DataChannels (SCTP). Low latency, high bandwidth, direct.

**Packet Structure:**
```
[ 4 bytes: Chunk Index (UInt32) ] [ N bytes: Encrypted Data (XOR) ]
```

### 2.5. Swarm Intelligence
*   **Bitfield Announcements:** Peers broadcast `have_chunks` messages to the mesh.
*   **Rarest-First (Planned):** Peers request chunks that are least replicated in the swarm.
*   **Tit-for-Tat (Implicit):** Bandwidth is contributed by all active peers.

## 3. Security Analysis

### 3.1. Threat Model: Compromised Relay
If the relay server is malicious or subpoenaed:
*   It sees: `Ciphertext`, `KeyA` (if sent via relay), `KeyB` (if sent via relay).
*   **Vulnerability:** If *both* keys go through the relay, the relay can decrypt.
*   **Mitigation:** ZKS prioritizes sending at least one key layer via direct P2P (WebRTC), bypassing the relay entirely.

### 3.2. Threat Model: Man-in-the-Middle (ISP)
*   All WebSocket traffic is TLS 1.3 encrypted (`wss://`).
*   All WebRTC traffic is DTLS encrypted.
*   The ISP sees only encrypted noise.

## 4. Market Positioning
ZKS sits in a unique "High-Privacy, Low-Friction" quadrant.

| Protocol | Privacy | Ease of Use | Speed |
| :--- | :--- | :--- | :--- |
| **ZKS** | **Extreme (Vernam)** | **High (Web Link)** | **High (Mesh)** |
| BitTorrent | Low (Public IP) | Low (Client Req.) | High |
| WeTransfer | Low (Server Access) | High | Medium |
| Signal | High | Medium (App Req.) | Low (File Limits) |

## 5. Protocol Extensibility & Future Applications

ZKS is not merely a file transfer tool; it is a **Transport Layer Protocol** for secure data streaming. Any binary stream can be protected by the Split-Streamed Vernam Cipher.

### 5.1 Real-Time Communication (RTC)
*   **Secure Chat:** Text streams are lightweight and can be encrypted with negligible bandwidth cost.
*   **Voice & Video:** UDP-based media streams can be XOR-encrypted in real-time. The "Key Node" simply acts as a high-throughput entropy pump.

### 5.2 Internet of Things (IoT)
*   **Critical Infrastructure:** For devices like pacemakers, power grid controllers, or autonomous vehicles, the "Bandwidth vs. Security" trade-off is acceptable. The mathematical certainty that a command cannot be forged or decrypted by a third party is paramount.

### 5.3 Decentralized VPN
*   **ZKS Tunnel:** Encapsulating IP packets within ZKS frames to create a VPN where the exit node (Relay) mathematically cannot know the content of the traffic, unlike Tor or VPN providers who rely on computational trust.

## 6. Conclusion
ZKS is indeed a new protocol. It formalizes a method for **Ephemeral, Multi-Key Mesh Sharing**. By decoupling the encryption keys from the data path and utilizing browser-native technologies, it democratizes "State-Level" privacy for the average user.
